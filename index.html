<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Ateşböceği Bulmacası — Tek Dosya Oyun</title>
<style>
:root{
  --bg:#0b0f26;
  --panel:#141a3f;
  --panel2:#192159;
  --ink:#eef0ff;
  --muted:#a9add6;
  --accent:#6c5dd3;  /* Talent14 mor */
  --gold:#ffde59;    /* Talent14 sarı */
  --good:#2ecc71;
  --bad:#ff595e;
}
*{box-sizing:border-box}
html,body{height:100%;margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial,sans-serif;background:radial-gradient(1200px 800px at 10% -10%, rgba(108,93,211,.18), transparent 30%), var(--bg); color:var(--ink)}
.wrap{max-width:1100px;margin:24px auto;padding:12px}
header h1{margin:0;font-size:clamp(22px,3vw,34px)}
header .sub{color:var(--muted);margin:6px 0 14px}

.board{display:grid;grid-template-columns:380px 1fr; gap:18px}
.card{background:linear-gradient(180deg,var(--panel),var(--panel2));border:1px solid rgba(255,255,255,.07);border-radius:16px; box-shadow:0 12px 32px rgba(0,0,0,.35); padding:14px}
.card h2{margin:2px 0 10px; font-size:16px; letter-spacing:.3px}

.toolbar{display:flex; flex-wrap:wrap; gap:8px}
.btn{background:linear-gradient(180deg,#273074,#1a1f55);border:1px solid rgba(255,255,255,.10); color:#fff; padding:10px 12px; border-radius:12px; cursor:pointer; font-weight:700; letter-spacing:.2px; box-shadow:0 8px 18px rgba(0,0,0,.25); transition:transform .05s, box-shadow .2s}
.btn:hover{box-shadow:0 12px 22px rgba(0,0,0,.35)}
.btn:active{transform:translateY(1px)}
.btn.acc{background:linear-gradient(180deg,var(--accent),#4e42c2)}
.btn.good{background:linear-gradient(180deg,#2f9b63,#177845)}
.btn.bad{background:linear-gradient(180deg,#a33d3d,#7c1f1f)}

.row{display:flex; justify-content:space-between; align-items:center; gap:10px; margin:10px 0}
.stat{color:var(--muted); font-size:14px}
select, input[type="number"]{background:#0e1333; border:1px solid rgba(255,255,255,.12); color:#fff; border-radius:10px; padding:8px}

/* Grid */
.stage{display:grid; gap:10px; place-items:center}
.grid{--n:5; --cell:80px; display:grid; grid-template-columns:repeat(var(--n), var(--cell)); grid-auto-rows:var(--cell); gap:10px; padding:10px; background:linear-gradient(180deg,#0e1333,#0a0f2b); border:1px solid rgba(255,255,255,.07); border-radius:16px; position:relative;}
.cell{width:var(--cell); height:var(--cell); border-radius:14px; display:grid; place-items:center; cursor:pointer; position:relative; overflow:hidden; border:1px solid rgba(255,255,255,.06)}
.cell .bug{width:42px; height:42px; border-radius:50%; box-shadow:0 0 0 0 rgba(255,222,89,.0), inset 0 0 12px rgba(255,255,255,.25); transition:transform .12s ease}
.cell.on{background:radial-gradient(80px 80px at 50% 45%, rgba(255,222,89,.22), rgba(255,222,89,.05) 60%, transparent 70%), linear-gradient(180deg,#212862,#1a1f4c)}
.cell.off{background:linear-gradient(180deg,#161a45,#10143a)}
.cell.on .bug{background:radial-gradient(18px 18px at 50% 40%, #fffbe6, #ffe77a 55%, #f3c623 80%); box-shadow:0 0 22px 6px rgba(255,222,89,.75)}
.cell.off .bug{background:radial-gradient(12px 12px at 50% 40%, #b3b6d1, #7f86b2 60%, #4a528a)}

.cell.hint::after{content:""; position:absolute; inset:0; border-radius:14px; box-shadow:0 0 0 3px rgba(255,222,89,.9) inset; animation:hint 1s ease-in-out 2}
@keyframes hint{0%{box-shadow:0 0 0 0 rgba(255,222,89,.0) inset}50%{box-shadow:0 0 0 3px rgba(255,222,89,.9) inset}100%{box-shadow:0 0 0 0 rgba(255,222,89,.0) inset}}

/* Modal */
.modal{position:fixed; inset:0; display:none; align-items:center; justify-content:center; background:rgba(5,6,16,.65); backdrop-filter:blur(5px)}
.modal.active{display:flex}
.modal .inner{background:linear-gradient(180deg,var(--panel),var(--panel2)); border:1px solid rgba(255,255,255,.10); padding:22px; border-radius:16px; max-width:520px; text-align:center}

/* Şifre satırı ve kopyala */
.pass{
  font-size:26px;            /* okunaklı büyük */
  font-weight:900;
  color:var(--gold);
  letter-spacing:1px;
  text-shadow:0 0 10px rgba(255,222,89,.9), 0 0 18px rgba(108,93,211,.6);
}
.copyline{
  display:flex;
  gap:8px;
  align-items:center;
  justify-content:center;
  margin:10px 0;
}
.copyline .btn{padding:10px 12px}

/* responsive */
@media (max-width:980px){
  .board{grid-template-columns:1fr}
  .grid{--cell:62px}
}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <h1>Ateşböceği Algoritma Oyunu</h1>
    <div class="sub">Amaç: <b>tüm ateşböceklerini söndür</b>. Bir hücreye tıklayınca o hücre ve <i>yandaki komşuları</i> (yukarı, aşağı, sağ, sol) durum değiştirir. En az hamlede bitirmeye çalış! 🌟</div>
  </header>

  <div class="board">
    <section class="card">
      <h2>Kontrol Paneli</h2>
      <div class="toolbar">
        <button id="new" class="btn acc">🌀 Yeni Karışım</button>
        <button id="undo" class="btn">↶ Geri Al</button>
        <button id="reset" class="btn">↺ Sıfırla</button>
        //<button id="hint" class="btn">💡 İpucu</button>
      </div>

      <div class="row">
        <div class="stat">Hamle: <b id="moves">0</b> | En İyi: <b id="best">—</b></div>
        <div class="row" style="gap:8px">
          <label class="stat">Boyut:</label>
          <select id="size">
            <option value="3">3×3 (Kolay)</option>
            <option value="5" selected>5×5 (Orta)</option>
            <option value="6">6×6 (Zor)</option>
          </select>
          <label class="stat">Karışıklık:</label>
          <input id="scramble" type="number" min="3" max="40" value="12" style="width:70px" />
        </div>
      </div>

      <div class="row">
        <div class="stat">Durum: <span id="state">Hazır</span></div>
        <div class="stat">Tohum (seed): <b id="seed">—</b></div>
      </div>

      <div class="row" style="margin-top:8px">
        <div class="stat">Not: Bu oyun <b>mantık, desen tanıma</b> ve <b>strateji</b> becerilerini güçlendirir.</div>
      </div>
    </section>

    <section class="card" style="display:grid; place-items:center">
      <div class="stage">
        <div id="grid" class="grid"></div>
      </div>
    </section>
  </div>
</div>

<!-- Kazanım Modal -->
<div id="modal" class="modal" role="dialog" aria-modal="true">
  <div class="inner">
    <h2>🎉 Tebrikler!</h2>
    <p>Tüm ateşböcekleri söndü — gece sakin ve huzurlu.</p>

    <!-- Şifre + Kopyala -->
    <div class="copyline">
      <span class="pass">Şifre: <span id="pwd">—</span></span>
      <button class="btn" id="copy">📋 Kopyala</button>
    </div>


    <button class="btn good" id="ok">Tamam</button>
  </div>
</div>

<script>
(function(){
  // Sabit şifre (uzun ve okunaklı)
  const FIXED_PASSWORD = 'FF-OKUL-2025-TR-9X7A-4QPM-ALGORITMA-42';

  // --- helpers ---
  const rnd = (min,max)=>Math.floor(Math.random()*(max-min+1))+min;
  const byId = id=>document.getElementById(id);

  // persistent best scores by key
  const store = {
    get(k){ try{return JSON.parse(localStorage.getItem(k))}catch{ return null } },
    set(k,v){ localStorage.setItem(k, JSON.stringify(v)) }
  };

  // game state
  let N = 5;                  // grid size
  let board=[];               // flat array length N*N, 0=off,1=on
  let moves=0;                // move counter
  let best=null;              // best for (N,seed)
  let seed=0;                 // scramble seed
  let scrambleCount=12;       // number of random clicks from solved state
  let history=[];             // stack of moves for undo

  // DOM
  const gridEl = byId('grid');
  const movesEl= byId('moves');
  const bestEl = byId('best');
  const stateEl= byId('state');
  const seedEl = byId('seed');
  const modal  = byId('modal');
  const pwdEl  = byId('pwd');
  const copyBtn= byId('copy');

  // UI events
  byId('size').addEventListener('change', e=>{ N=parseInt(e.target.value,10); newGame(); });
  byId('scramble').addEventListener('change', e=>{ scrambleCount = clampInt(e.target.value,3,40); newGame(); });
  byId('new').addEventListener('click', newGame);
  byId('reset').addEventListener('click', resetBoard);
  byId('undo').addEventListener('click', undo);
  //byId('hint').addEventListener('click', hint);
  byId('ok').addEventListener('click', ()=>modal.classList.remove('active'));
  modal.addEventListener('click', e=>{ if(e.target===modal) modal.classList.remove('active'); });

  function clampInt(v,a,b){ v=parseInt(v,10)||a; return Math.max(a, Math.min(b, v)); }

  function key(){ return `firefly-best-${N}-${seed}` }

  function setState(txt){ stateEl.textContent = txt }

  function idx(x,y){ return y*N + x }

  function inBounds(x,y){ return x>=0 && y>=0 && x<N && y<N }

  function cellAt(x,y){ return gridEl.querySelector(`[data-x="${x}"][data-y="${y}"]`) }

  function renderGrid(){
    gridEl.style.setProperty('--n', N);
    gridEl.innerHTML='';
    for(let y=0;y<N;y++){
      for(let x=0;x<N;x++){
        const d=document.createElement('div');
        d.className='cell';
        d.dataset.x=x; d.dataset.y=y;
        d.innerHTML='<div class="bug"></div>';
        d.addEventListener('click', ()=> clickCell(x,y,true));
        gridEl.appendChild(d);
      }
    }
    paint();
  }

  function paint(){
    for(let y=0;y<N;y++) for(let x=0;x<N;x++){
      const on = board[idx(x,y)]===1;
      const c = cellAt(x,y);
      c.classList.toggle('on', on);
      c.classList.toggle('off', !on);
    }
  }

  function toggle(x,y){ if(!inBounds(x,y)) return; board[idx(x,y)] ^= 1; }

  function clickCell(x,y,countMove){
    // push history before change
    const snap = board.slice();
    // toggle plus neighbors
    toggle(x,y); toggle(x-1,y); toggle(x+1,y); toggle(x,y-1); toggle(x,y+1);
    paint();
    if(countMove){
      history.push(snap);
      moves++; movesEl.textContent=moves;
      setState('Oynanıyor');
      checkWin();
    }
  }

  function randomizeWithSeed(s){
    // simple LCG for reproducible randomness
    let v = (s>>>0) || 1;
    return ()=>{ v = (1664525*v + 1013904223) >>> 0; return v/4294967296 };
  }

  function scramble(){
    // start from solved (all off) and apply k random valid clicks
    board = new Array(N*N).fill(0);
    const r = randomizeWithSeed(seed);
    for(let i=0;i<scrambleCount;i++){
      const x=Math.floor(r()*N), y=Math.floor(r()*N);
      clickCell(x,y,false); // do not count move / history
    }
    moves=0; history.length=0; movesEl.textContent='0';
    setState('Hazır');
    paint();
  }

  function resetBoard(){
    // re-scramble with same seed
    scramble();
  }

  function newGame(){
    seed = Date.now() % 100000;  // short seed
    seedEl.textContent = seed;
    best = store.get(key());
    bestEl.textContent = best==null ? '—' : best;
    renderGrid();
    scramble();
  }

  function undo(){
    if(history.length===0) return;
    board = history.pop();
    moves=Math.max(0,moves-1); movesEl.textContent=moves;
    paint();
  }

  function isSolved(){ return board.every(v=>v===0) }

  function checkWin(){
    if(isSolved()){
      setState('Bitti!');
      if(best==null || moves<best){ best=moves; bestEl.textContent=best; store.set(key(),best); }
      // SABİT ŞİFREYİ GÖSTER
      pwdEl.textContent = FIXED_PASSWORD;
      modal.classList.add('active');
    }
  }

  // Güvenli kopyalama (HTTPS/localhost) + fallback (HTTP/file)
  async function copyToClipboard(text){
    try{
      if (navigator.clipboard && window.isSecureContext) {
        await navigator.clipboard.writeText(text);
        return true;
      } else {
        const ta = document.createElement('textarea');
        ta.value = text;
        ta.setAttribute('readonly', '');
        ta.style.position = 'fixed';
        ta.style.top = '-9999px';
        document.body.appendChild(ta);
        ta.select();
        const ok = document.execCommand('copy');
        document.body.removeChild(ta);
        return ok;
      }
    }catch(e){
      console.warn('Clipboard failed:', e);
      return false;
    }
  }

  if (copyBtn) {
    copyBtn.addEventListener('click', async ()=>{
      const ok = await copyToClipboard((pwdEl.textContent || '').trim());
      copyBtn.textContent = ok ? '✅ Kopyalandı' : '❌ Kopyalanamadı';
      setTimeout(()=> copyBtn.textContent = '📋 Kopyala', 1500);
    });
  }

  // kick off
  newGame();
})();
</script>
</body>
</html>
